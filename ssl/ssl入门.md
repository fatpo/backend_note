## SSL会话主要三步：

```commandline
①客户端向服务器端索要并验正证书；
②双方协商生成“会话密钥”；
③双方采用“会话密钥”进行加密通信；
```

## SSL 握手协议 Handshake Protocol：

```commandline
第一阶段：ClientHello
支持的协议版本，比如tls 1.2；
客户端生成一个随机数，稍后用户生成“会话密钥”
支持的加密算法，比如AES、3DES、RSA；
支持的压缩算法；

第二阶段：ServerHello
确认使用的加密通信协议版本，比如tls 1.2；
服务器端生成一个随机数，稍后用于生成“会话密钥”
确认使用的加密方法；
服务器证书；

第三阶段
验正服务器证书，在确认无误后取出其公钥；（发证机构、证书完整性、证书持有者、证书有效期、吊销列表）
发送以下信息给服务器端：
编码变更通知，表示随后的信息都将用双方商定的加密方法和密钥发送；
客户端握手结束通知；

第四阶段
收到客户端发来的第三个随机数pre-master-key后，计算生成本次会话所有到的“会话密钥”；
向客户端发送如下信息：
编码变更通知，表示随后的信息都将用双方商定的加密方法和密钥发送；
服务端握手结束通知；
```

## 什么是CSR ？ 什么是公钥和私钥？

* CSR
    * 含义
        * Certificate Signing Request的英文缩写，即证书请求文件
    * 背景
        * 我们想要证明我们的网站是可信的，数据传输是加密的,我们就需要由第三方CA机构颁发的证书来证明，比如Symantec，GeoTrust等等。
    * 申请证书步骤
        * 1、想要申请这样的证书，我们的第一步就是需要生成我们自己的CSR文件。
        * 2、CSR需要由申请人提供域名、公司名称、部门、省份、城市、国家借助相关工具（`比如openssl`）生成。
        * 3、工具同时会生成`证书请求文件`和`私钥文件`,其中的证书请求文件就是CSR文件，这两个文件是相互匹配的。
        * 4、我们将CSR文件提交给CA申请证书，经过CA身份对申请者身份进行审核后，颁发`证书公钥`。
        * 5、申请人收到证书文件后，将证书公钥文件配合私钥文件转化成服务器对应的格式的文件部署在HTTP服务器上面。

## CA 证书的分类

* 证书
  * 有些证书将以`合并形式`出现。其中一个文件可以`包含以下任何一个`：证书，私钥，公钥，签名证书，证书颁发机构（CA）和/或授权链。
  * 后缀：
    * .DER：用二进制DER编码的证书；
    * .PEM：用ASCLL(BASE64)编码的证书； 
    * .CER：存放公钥，没有私钥； 
    * .PFX：存放公钥和私钥，.pfx 主要用于windows平台，浏览器可以使用，也是包含证书和私钥，获取私钥需要密码才可以
  * 编码 
    * PEM = PEM扩展名用于不同类型的X.509v3文件，这些文件包含前缀为“-BEGIN ...”行的ASCII（Base64）装载数据。
      * X509文件扩展名（x509  这种证书只有公钥，不包含私钥。） 
    * DER
      * DER扩展用于二进制DER编码证书。这些文件也可能带有CER或CRT扩展名。
      * 正确的英语用法是“我有DER编码证书”而不是“我有DER证书”。
  * 组合
    * 在某些情况下，将多个X.509基础结构组合成单个文件是有利的。一个常见的例子是将私钥和公钥组合到同一个证书中。
    * 组合证书密钥和链的最简单方法是将每个密钥转换为PEM编码证书，然后将每个文件的内容简单复制到新文件中。这适用于组合文件以在Apache应用程序中使用。
  * 萃取
    * 有些证书将以合并形式出现。其中一个文件可以包含以下任何一个：证书，私钥，公钥，签名证书，证书颁发机构（CA）和/或授权链。
    
## pem文件和key文件的区别？

* PEM
    * 含义：用ASCLL(BASE64)编码的证书；
    * 存储的是证书base64加密+分隔符，也就是说pem存的是证书；
    * PEM格式通常用于数字证书认证机构（Certificate Authorities，CA），扩展名为.pem, .crt, .cer, and .key；
    * 内容为Base64编码的ASCII码文件，有类似"-----BEGIN CERTIFICATE-----" 和 "-----END CERTIFICATE-----"的头尾标记；
    * 服务器认证证书，中级认证证书和私钥都可以储存为PEM格式（认证证书其实就是公钥）。
    * Apache和类似的服务器使用PEM格式证书。
* KEY
    * 私钥base64加密还有格式+分割符，key 存的是私钥
